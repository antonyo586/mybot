const { Telegraf } = require('telegraf');

const bot = new Telegraf('7769985700:AAFslhp9tMVAFi3pswejwjsia0UBbTPJjQQ'); // –í—Å—Ç–∞–≤—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω

// ID –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–∏)
const CHANNELS = [
    '-1002453596396',  // ID –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
    '-1002273108877',  // ID –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
    '-1002175702436'   // ID —Ç—Ä–µ—Ç—å–µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
];

bot.start((ctx) => {
    ctx.reply(
        '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —ç—Ç–æ —Ç–∏–∫ —Ç–æ–∫ —Ç–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç!\n\n' +
        '–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –±–æ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±–∞–≥–∏, –∏ —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ –æ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ Telegram!\n\n' +
        '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —ç—Ç–æ–≥–æ –±–æ—Ç–∞, –≤–∞–º –Ω—É–∂–Ω–æ –≤—Å–µ–≥–æ –ª–∏—à—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤, –∏ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –±–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, —è –ø—Ä–∏—à–ª—é –≤–∞–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!\n\n' +
        '–î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å—Ç–∞–ª–æ—Å—å 3 –¥–Ω—è 17 —á–∞—Å–æ–≤',
        {
            reply_markup: {
                inline_keyboard: [
                    [{ text: 'üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤', url: 'https://t.me/joinchat/XXXXX' }],
                    [{ text: 'üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤', url: 'https://t.me/joinchat/YYYYY' }],
                    [{ text: 'üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤', url: 'https://t.me/joinchat/ZZZZZ' }],
                    [{ text: '‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É', callback_data: 'check' }]
                ]
            }
        }
    );
});

bot.action('check', async (ctx) => {
    try {
        let allSubscribed = true;

        for (const channel of CHANNELS) {
            const chatMember = await ctx.telegram.getChatMember(channel, ctx.from.id);
            if (!['member', 'administrator', 'creator'].includes(chatMember.status)) {
                allSubscribed = false;
                break;
            }
        }

        await ctx.answerCbQuery(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

        if (allSubscribed) {
            await ctx.reply('‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É! –ú—ã —É–≤–µ–¥–æ–º–∏–º –≤–∞—Å, –∫–æ–≥–¥–∞ –±–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.');
        } else {
            await ctx.reply('‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –≤—Å–µ –∫–∞–Ω–∞–ª—ã. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:', error);
        await ctx.reply('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤.');
    }
});

bot.launch();
console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!');
